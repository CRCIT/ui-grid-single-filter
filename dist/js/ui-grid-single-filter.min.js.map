{"version":3,"sources":["ui-grid-single-filter.js"],"names":["angular","module","directive","uiGridSingleFilterService","uiGridFilterValueService","restrict","replace","priority","require","scope","compile","pre","$scope","$elm","$attrs","uiGridCtrl","grid","registerRowsProcessor","singleFilter","link","element","attrs","filterValue","bind","event","$$element","val","refresh","preventDefault","factory","service","getPropertyWithColumnDef","entity","columnDef","_isFunction","functionToCheck","getType","toString","call","field","filterField","indexOf","property","arrayOfLevels","split","i","length","renderableRows","concatEntityFPropertiesSelectedAsField","row","concatedProperties","columnDefs","options","concat","prop","createFilterRegex","search","caseInsensitive","_fnEscapeRegex","sVal","_re_escape_regex","RegExp","join","a","$","map","match","word","charAt","m","matcher","forEach","filterData","visible"],"mappings":"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","file":"ui-grid-single-filter.min.js","sourcesContent":["/*!\n * ui-grid-single-filter\n * null\n * @license undefined\n * vundefined\n * 2016-09-29T10:37:31.617Z\n */\n(function () {\n  'use strict';\n\n  /**\n   * @ngdoc module\n   * @name ui.grid.single.filter\n   * @description Main plugin module\n   */\n  angular.module('ui.grid.single.filter', ['ui.grid']);\n\n})();\n\n/**\n * Created by rvalero on 13/09/16.\n */\n(function () {\n  'use strict';\n\n  angular.module('ui.grid.single.filter')\n\n  /**\n   * @ngdoc factory\n   * @name ui\n   */\n    .directive('uiGridSingleFilter', ['uiGridSingleFilterService','uiGridFilterValueService',\n      function (uiGridSingleFilterService, uiGridFilterValueService) {\n        return {\n          restrict:'A',\n          replace: true,\n          priority: 10,\n          require: '^uiGrid',\n          scope: false,\n          compile: function () {\n            return {\n              pre: function ($scope, $elm, $attrs, uiGridCtrl) {\n                uiGridCtrl.grid.registerRowsProcessor( uiGridSingleFilterService.singleFilter, 200 );\n                uiGridFilterValueService.grid = uiGridCtrl.grid;\n              }\n            };\n          }\n        };\n      }]);\n\n})();\n\n/**\n * Created by rvalero on 13/09/16.\n */\n(function () {\n  'use strict';\n\n  angular.module('ui.grid.single.filter')\n\n  /**\n   * @ngdoc factory\n   * @name ui\n   */\n    .directive('uiGridSingleFilterValue', ['uiGridFilterValueService',\n      function (uiGridFilterValueService) {\n        return {\n          restrict: 'A',\n          scope:false,\n          link: function (scope, element, attrs) {\n            uiGridFilterValueService.filterValue = null;\n            element.bind(\"keyup\", function (event) {\n              uiGridFilterValueService.filterValue = attrs.$$element.val();\n              uiGridFilterValueService.grid.refresh();\n              event.preventDefault();\n            });\n          }\n        };\n      }]);\n\n})();\n\n/**\n * Created by rvalero on 13/09/16.\n */\n(function () {\n  'use strict';\n\n  angular.module('ui.grid.single.filter')\n\n  /**\n   * @ngdoc factory\n   * @name ui\n   */\n    .factory('uiGridFilterValueService', function() {\n      var filterValue = null;\n      var grid = null;\n\n      return {\n        filterValue:filterValue,\n        grid:grid\n      }\n    });\n\n})();\n\n/**\n * Created by rvalero on 13/09/16.\n */\n/**\n * Created by rvalero on 13/09/16.\n */\n(function () {\n  'use strict';\n\n  angular.module('ui.grid.single.filter')\n    .service('uiGridSingleFilterService',['uiGridFilterValueService', function(uiGridFilterValueService) {\n      //service body\n\n      return {\n        singleFilter:singleFilter,\n        getPropertyWithColumnDef:getPropertyWithColumnDef\n      };\n\n\n      function getPropertyWithColumnDef(entity,columnDef) {\n        if(!columnDef) return '';\n        var field =  columnDef.filterField || columnDef.field;\n\n        if(_isFunction(field)) {\n          return field(entity);\n        }\n\n        if(field.indexOf('.') < 0 ) return entity[field];\n\n        var property = entity;\n        var arrayOfLevels = field.split('.');\n\n        for( var i=0; i < arrayOfLevels.length ; i++ ) {\n          if(!property) return '';\n          property = property[arrayOfLevels[i]];\n        }\n\n        return property;\n\n        function _isFunction(functionToCheck) {\n          var getType = {};\n          return functionToCheck && getType.toString.call(functionToCheck) === '[object Function]';\n        }\n      }\n\n      function singleFilter( renderableRows ) {\n        if (!uiGridFilterValueService.filterValue) {\n          return renderableRows;\n        }\n        var matcher = createFilterRegex(uiGridFilterValueService.filterValue, true);\n        renderableRows.forEach( function( row ) {\n          var filterData = concatEntityFPropertiesSelectedAsField(row);\n\n          var match = filterData.match(matcher);\n\n          if ( !match ){\n            row.visible = false;\n          }\n        });\n        return renderableRows;\n\n\n        function concatEntityFPropertiesSelectedAsField(row) {\n\n          var concatedProperties = '';\n          var fields = [];\n          var columnDefs = row.grid.options ? row.grid.options.columnDefs : [];\n          columnDefs = columnDefs || [];\n\n          if(columnDefs.length > 0) {\n            for(var i=0; i < columnDefs.length; i++) {\n              if(columnDefs[i].field && getPropertyWithColumnDef( row.entity,columnDefs[i]) ){\n                concatedProperties = concatedProperties.concat( getPropertyWithColumnDef(row.entity,columnDefs[i]) );\n              }\n            }\n          } else {\n            for(var prop in row.entity) {\n              if( typeof prop === \"string\") {\n                concatedProperties = concatedProperties.concat(prop);\n              }\n            }\n          }\n\n          return concatedProperties;\n        }\n\n\n        function createFilterRegex (search, caseInsensitive) {\n          search = _fnEscapeRegex( search );\n          var a = $.map( search.match( /\"[^\"]+\"|[^ ]+/g ) || [''], function ( word ) {\n            if ( word.charAt(0) === '\"' ) {\n              var m = word.match( /^\"(.*)\"$/ );\n              word = m ? m[1] : word;\n            }\n\n            return word.replace('\"', '');\n          } );\n\n          search = '^(?=.*?'+a.join( ')(?=.*?' )+').*$';\n          return new RegExp( search, caseInsensitive ? 'i' : '' );\n\n          /**\n           * Escape a string such that it can be used in a regular expression\n           *  @param {string} sVal string to escape\n           *  @returns {string} escaped string\n           *  @memberof DataTable#oApi\n           */\n          function _fnEscapeRegex ( sVal ) {\n            // Escape regular expression special characters\n            var _re_escape_regex = new RegExp( '(\\\\' + [ '/', '.', '*', '+', '?', '|', '(', ')', '[', ']', '{', '}', '\\\\', '$', '^', '-' ].join('|\\\\') + ')', 'g' );\n            return sVal.replace( _re_escape_regex, '\\\\$1' );\n          }\n        }\n      }\n    }]);\n\n  /**\n   * @ngdoc factory\n   * @name ui\n   */\n\n})();\n"],"sourceRoot":"/source/"}