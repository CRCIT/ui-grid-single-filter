{"version":3,"sources":["ui-grid-single-filter.js"],"names":["angular","module","directive","uiGridSingleFilterService","uiGridFilterValueService","restrict","replace","priority","require","scope","compile","pre","$scope","$elm","$attrs","uiGridCtrl","grid","registerRowsProcessor","singleFilter","link","element","attrs","filterValue","bind","event","$$element","val","refresh","preventDefault","factory","service","Grid","uiGridConstants","gridUtil","$compile","$parse","$interpolate","renderableRows","_concatCellValues","row","addFilterProperty","renderedValue","_removeHTML","concatedProperties","concat","columns","forEach","col","idx","colDef","singleFilterSearchable","singleFilterValue","getRenderStringValue","getRenderedCellValue","singleFilterAdditionalValue","additionalValue","html","_replaceFieldWithExpression","cellTemplate","cellValue","string","expressionString","input","replacedInput","MODEL_COL_FIELD","preEval","field","COL_FIELD","text","String","_createFilterRegex","search","caseInsensitive","_fnEscapeRegex","sVal","_re_escape_regex","RegExp","join","a","$","map","match","word","charAt","m","matcher","filterData","visible"],"mappings":"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","file":"ui-grid-single-filter.min.js","sourcesContent":["/*!\n * ui-grid-single-filter\n * https://github.com/CRCIT/ui-grid-single-filter\n * @license Apache-2.0\n * v0.3.0\n * 2016-10-17T09:55:48.114Z\n */\n(function () {\n  'use strict';\n\n  /**\n   * @ngdoc module\n   * @name ui.grid.single.filter\n   * @description Main plugin module\n   */\n  angular.module('ui.grid.single.filter', ['ui.grid']);\n\n})();\n\n/**\n * Created by rvalero on 13/09/16.\n */\n(function () {\n  'use strict';\n\n  angular.module('ui.grid.single.filter')\n\n  /**\n   * @ngdoc factory\n   * @name ui\n   */\n    .directive('uiGridSingleFilter', ['uiGridSingleFilterService','uiGridFilterValueService',\n      function (uiGridSingleFilterService, uiGridFilterValueService) {\n        return {\n          restrict:'A',\n          replace: true,\n          priority: 10,\n          require: '^uiGrid',\n          scope: false,\n          compile: function () {\n            return {\n              pre: function ($scope, $elm, $attrs, uiGridCtrl) {\n                uiGridCtrl.grid.registerRowsProcessor( uiGridSingleFilterService.singleFilter, 200 );\n                uiGridFilterValueService.grid = uiGridCtrl.grid;\n              }\n            };\n          }\n        };\n      }]);\n\n})();\n\n/**\n * Created by rvalero on 13/09/16.\n */\n(function () {\n  'use strict';\n\n  angular.module('ui.grid.single.filter')\n\n  /**\n   * @ngdoc factory\n   * @name ui\n   */\n    .directive('uiGridSingleFilterValue', ['uiGridFilterValueService',\n      function (uiGridFilterValueService) {\n        return {\n          restrict: 'A',\n          scope:false,\n          link: function (scope, element, attrs) {\n            uiGridFilterValueService.filterValue = null;\n            element.bind(\"keyup\", function (event) {\n              uiGridFilterValueService.filterValue = attrs.$$element.val();\n              uiGridFilterValueService.grid.refresh();\n              event.preventDefault();\n            });\n          }\n        };\n      }]);\n\n})();\n\n/**\n * Created by rvalero on 13/09/16.\n */\n(function () {\n  'use strict';\n\n  angular.module('ui.grid.single.filter')\n\n  /**\n   * @ngdoc factory\n   * @name ui\n   */\n    .factory('uiGridFilterValueService', function() {\n      var filterValue = null;\n      var grid = null;\n\n      return {\n        filterValue:filterValue,\n        grid:grid\n      }\n    });\n\n})();\n\n/**\n * Created by rvalero on 13/09/16.\n */\n/**\n * Created by rvalero on 13/09/16.\n */\n(function () {\n  'use strict';\n\n  angular.module('ui.grid.single.filter')\n    .service('uiGridSingleFilterService',['uiGridFilterValueService' , 'Grid', 'uiGridConstants', 'gridUtil', '$compile', '$rootScope', '$parse', '$interpolate', function(uiGridFilterValueService, Grid, uiGridConstants, gridUtil, $compile, $scope, $parse, $interpolate) {\n      //service body\n\n      return {\n        singleFilter:singleFilter\n      };\n\n      function singleFilter( renderableRows ) {\n        if (!uiGridFilterValueService.filterValue) {\n          return renderableRows;\n        }\n\n        var matcher = _createFilterRegex(uiGridFilterValueService.filterValue, true);\n\n        renderableRows.forEach( function( row ) {\n          var filterData = _concatCellValues(row);\n\n          var match = filterData.match(matcher);\n          if ( !match ){\n            row.visible = false;\n          }\n        });\n\n        return renderableRows;\n\n        function _concatCellValues(row) {\n          var concatedProperties = '';\n\n          function addFilterProperty(renderedValue) {\n            renderedValue = _removeHTML(renderedValue);\n            concatedProperties = concatedProperties.concat(renderedValue).concat('  ');\n          }\n\n          if (row.grid.columns) {\n            row.grid.columns.forEach(function (col, idx) {\n              var renderedValue;\n\n              if (!col.colDef || col.colDef.singleFilterSearchable !== false) {\n                if (col.colDef && col.colDef.singleFilterValue) {\n                  renderedValue = getRenderStringValue(row, col, (col.colDef.singleFilterValue));\n                }\n                else {\n                  renderedValue = getRenderedCellValue(row, col);\n                }\n                addFilterProperty(renderedValue);\n\n                if (col.colDef && col.colDef.singleFilterAdditionalValue) {\n                  var additionalValue = getRenderStringValue(row, col, (col.colDef.singleFilterAdditionalValue));\n                  addFilterProperty(additionalValue);\n                }\n\n              }\n\n            });\n          }\n\n          return concatedProperties;\n        }\n\n        function getRenderedCellValue(row, col) {\n          $scope.grid = row.grid;\n          $scope.row = row;\n          $scope.col = col;\n\n          var html = _replaceFieldWithExpression($scope, $scope.col.cellTemplate);\n          var cellTemplate = $compile(html)($scope);\n          var cellValue = $interpolate(cellTemplate.html())($scope);\n          return cellValue;\n        }\n\n        function getRenderStringValue(row, col, string) {\n          $scope.grid = row.grid;\n          $scope.row = row;\n          $scope.col = col;\n\n          var expressionString = _replaceFieldWithExpression($scope, string);\n          var renderedValue = $interpolate(expressionString)($scope);\n          return renderedValue;\n        }\n\n        function _replaceFieldWithExpression($scope, input) {\n          var replacedInput = input\n            .replace(uiGridConstants.MODEL_COL_FIELD, 'row.entity.' + gridUtil.preEval($scope.col.field))\n            .replace(uiGridConstants.COL_FIELD, 'grid.getCellValue(row, col)');\n          return replacedInput;\n        }\n\n        function _removeHTML (text) {\n          return  text ? String(text).replace(/<[^>]+>/gm, '') : '';\n        }\n\n        function _createFilterRegex (search, caseInsensitive) {\n          search = _fnEscapeRegex( search );\n          var a = $.map( search.match( /\"[^\"]+\"|[^ ]+/g ) || [''], function ( word ) {\n            if ( word.charAt(0) === '\"' ) {\n              var m = word.match( /^\"(.*)\"$/ );\n              word = m ? m[1] : word;\n            }\n\n            return word.replace('\"', '');\n          } );\n\n          search = '^(?=.*?'+a.join( ')(?=.*?' )+').*$';\n          return new RegExp( search, caseInsensitive ? 'i' : '' );\n\n          /**\n           * Escape a string such that it can be used in a regular expression\n           *  @param {string} sVal string to escape\n           *  @returns {string} escaped string\n           *  @memberof DataTable#oApi\n           */\n          function _fnEscapeRegex ( sVal ) {\n            // Escape regular expression special characters\n            var _re_escape_regex = new RegExp( '(\\\\' + [ '/', '.', '*', '+', '?', '|', '(', ')', '[', ']', '{', '}', '\\\\', '$', '^', '-' ].join('|\\\\') + ')', 'g' );\n            return sVal.replace( _re_escape_regex, '\\\\$1' );\n          }\n        }\n      }\n    }]);\n\n  /**\n   * @ngdoc factory\n   * @name ui\n   */\n\n})();\n"]}